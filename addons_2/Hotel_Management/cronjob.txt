<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="cron_check_unrented_rooms" model="ir.cron">
        <field name="name">Check Unrented Rooms</field>
        <field name="model_id" ref="model_hotel_room"/>
        <field name="state">code</field>
        <field name="code">
rooms = env['hotel.room'].search([('state', '=', 'available')])
for room in rooms:
    # Kiểm tra lịch sử đặt phòng trong 7 ngày qua
    last_week = fields.Date.today() - timedelta(days=7)
    bookings = env['hotel.room'].search_count([
        ('id', '=', room.id),
        ('state', '=', 'booked'),
        ('create_date', '>=', last_week)
    ])
    
    if bookings == 0:
        # Gửi email thông báo
        template = env.ref('hotel_room.email_template_unrented_room')
        if template:
            template.send_mail(room.id, force_send=True)</field>
        <field name="interval_number">1</field>
        <field name="interval_type">days</field>
        <field name="nextcall" eval="(DateTime.now() + timedelta(days=1)).strftime('%Y-%m-%d %H:%M:%S')"/>
        <field name="doall" eval="False"/>
        <field name="active" eval="True"/>
        <field name="user_id" ref="base.user_admin"/>
    </record>



    
    <record id="email_template_unrented_room" model="mail.template">
        <field name="name">Unrented Room Notification</field>
        <field name="model_id" ref="model_hotel_room"/>
        <field name="subject">Room ${object.name} hasn't been rented for a week</field>
        <field name="email_from">${user.email_formatted}</field>
        <field name="email_to">fomeg04@gmail.com</field>
        <field name="body_html"><![CDATA[
            <p>Dear Manager,</p>
            <p>Room ${object.name} at ${object.hotel_id.name} hasn't been rented for the past week.</p>
            <p>Current price: ${object.price}</p>
            <p>Consider adjusting the price to increase occupancy.</p>
        ]]></field>
    </record>
</odoo>